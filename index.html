<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Royal City</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <main>
    <section class="menu-bar">
      <button class="menu-btn" aria-label="Menu" id="menu-toggle">
        <span class="menu-label">Menu</span>
        <span class="menu-caret">‚ñæ</span>
      </button>
      <div class="menu-meta">
        <span class="pill small muted" id="round-indicator">Round 1 / 8</span>
      </div>
    </section>
    <div id="spine"><div></div></div>

    <section class="hero frame board-frame" id="frame-board" data-panel="board">
      <div class="section-heading board-heading">
        <div>
          <h2>üß± Royal City</h2>
          <div class="section-subline">Civic planning board</div>
        </div>
      </div>
      <div class="board-stage">
        <div class="board-stage__board">
          <div id="board-wrap" class="board-wrap">
            <div id="board" class="board"></div>
          </div>
        </div>
        <div class="board-stage__aside">
          <div class="board-aside">
            <div class="board-aside__title">üéØ Round focus</div>
            <p class="board-aside__body" id="board-focus-text">Align initiatives, publish census, then grow.</p>
          </div>
        </div>
      </div>
      <div id="build-panel" class="build-panel">
        <div class="build-panel__header">
          <div>
            <div class="build-panel__title">üß± Build Placement</div>
            <div class="build-panel__sub">Click a cell to place. Remaining capacity follows tricks won.</div>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button id="build-clear" class="btn ghost small" type="button">Clear round placements</button>
            <button id="build-confirm" class="btn primary small" type="button">Confirm placements</button>
          </div>
        </div>
        <div class="build-assets">
          <div class="build-assets__title">üèóÔ∏è Initiative assets</div>
          <div id="build-assets-available" class="build-assets__available"></div>
          <div id="build-asset-placements" class="build-placements"></div>
        </div>
        <div id="build-capacity" class="build-capacity"></div>
        <div id="build-placements" class="build-placements"></div>
        <div id="build-message" class="build-message"></div>
      </div>
    </section>

    <section class="frame" id="frame-input" data-panel="round-input">
      <h2>üìã Census Intake</h2>
      <form id="round-form">
        <div class="inputs-grid">
          <label>Tricks in Clubs <span class="sector sector--inf" data-sector="INF" data-suit="‚ô£">Infrastructure</span>
            <div class="trick-input">
              <button type="button" class="trick-step" data-target="clubs" data-step="-1" aria-label="Decrease clubs">‚àí</button>
              <input id="clubs" data-suit="clubs" class="trick-number" type="number" min="0" max="13" step="1" value="0" inputmode="numeric">
              <button type="button" class="trick-step" data-target="clubs" data-step="1" aria-label="Increase clubs">+</button>
            </div>
          </label>
          <label>Tricks in Diamonds <span class="sector sector--eco" data-sector="ECO" data-suit="‚ô¶">Economy</span>
            <div class="trick-input">
              <button type="button" class="trick-step" data-target="diamonds" data-step="-1" aria-label="Decrease diamonds">‚àí</button>
              <input id="diamonds" data-suit="diamonds" class="trick-number" type="number" min="0" max="13" step="1" value="0" inputmode="numeric">
              <button type="button" class="trick-step" data-target="diamonds" data-step="1" aria-label="Increase diamonds">+</button>
            </div>
          </label>
          <label>Tricks in Hearts <span class="sector sector--res" data-sector="RES" data-suit="‚ô•">Residential</span>
            <div class="trick-input">
              <button type="button" class="trick-step" data-target="hearts" data-step="-1" aria-label="Decrease hearts">‚àí</button>
              <input id="hearts" data-suit="hearts" class="trick-number" type="number" min="0" max="13" step="1" value="0" inputmode="numeric">
              <button type="button" class="trick-step" data-target="hearts" data-step="1" aria-label="Increase hearts">+</button>
            </div>
          </label>
          <label>Tricks in Spades <span class="sector sector--gov" data-sector="GOV" data-suit="‚ô†">Civic</span>
            <div class="trick-input">
              <button type="button" class="trick-step" data-target="spades" data-step="-1" aria-label="Decrease spades">‚àí</button>
              <input id="spades" data-suit="spades" class="trick-number" type="number" min="0" max="13" step="1" value="0" inputmode="numeric">
              <button type="button" class="trick-step" data-target="spades" data-step="1" aria-label="Increase spades">+</button>
            </div>
          </label>
        </div>
        <div id="remaining" class="pill" style="width: fit-content; margin: 4px 0;">Remaining: 13</div>
        <button type="submit">Publish Ledger</button>
      </form>
      <div id="round-info" style="margin-top: 10px; color: var(--muted);"></div>
    </section>

    <section class="frame" id="frame-missions" data-panel="missions">
      <div class="section-heading">
        <h2>üß© Initiatives</h2>
        <div class="phase-actions">
          <button id="missions-forward" class="btn primary small" aria-label="Continue to Census Intake">Next</button>
        </div>
      </div>
      <div class="phase-callout" id="mission-round-callout">
        <span class="pill warn" id="mission-round-label">Start of round</span>
        <div class="phase-callout__body" id="mission-round-body">
          Deal a fresh hand to kick off the round before moving to Census.
        </div>
      </div>
      <div class="mission-context" id="mission-context-line">üß© Round 1: Establish early infrastructure and avoid blight.</div>
      <div id="road-status-indicator" class="pill" style="margin-bottom:8px; display:none;">üõ£Ô∏è Highway Network: Pending authorization</div>
      <div class="mission-special" id="mission-road-expansion-block" style="display:none;"></div>
      <div id="missions-list" class="missions-list">Missions will generate each round.</div>
    </section>

    <section class="frame" id="frame-metrics" data-panel="stats">
      <div class="section-heading">
        <h2>üìä Civic Metrics</h2>
        <div class="phase-actions">
          <button id="stats-undo" class="btn ghost small" aria-label="Undo Publish">Undo</button>
          <button id="stats-forward" class="btn primary small" aria-label="End Round">End Round</button>
        </div>
      </div>
      <div id="stats" class="stat-strip"></div>
      <div id="council-reco" class="reco-panel is-hidden">
        <div class="reco-heading">
          <div class="reco-title" id="reco-title">üìå Council Recommendation</div>
          <div class="reco-sub" id="reco-sub">After resolution</div>
        </div>
        <div class="reco-body" id="reco-body">Awaiting resolution‚Ä¶</div>
        <div class="reco-warning" id="reco-warning"></div>
        <div class="reco-actions">
          <button id="reco-continue" class="btn primary small" aria-label="Continue to next phase">Continue</button>
        </div>
      </div>
    </section>

    <section class="frame" id="frame-status" data-panel="status">
      <h2>üèôÔ∏è City Status</h2>
      <div id="city-status"></div>
      <div id="city-status-debug" style="margin-top:8px; font-size:12px; color:var(--muted); display:none;"></div>
      <div id="city-status-debug-toggle" style="margin-top:6px; font-size:12px; color:var(--accent); cursor:pointer; display:none;">Details</div>
    </section>

    <section class="frame" id="frame-report" data-panel="report">
      <div class="section-heading">
        <h2>üìú Planning Memo</h2>
        <div class="phase-actions">
          <button id="report-undo" class="btn ghost small" aria-label="Undo Publish">Undo</button>
          <button id="report-forward" class="nav-btn" aria-label="Next Round">‚Üí</button>
        </div>
      </div>
      <pre id="report-output">Awaiting first resolution‚Ä¶</pre>
      <details class="history-collapse">
        <summary>History</summary>
        <ul id="history" style="margin: 8px 0 0; padding-left: 18px; color: var(--muted);"></ul>
      </details>
    </section>

    <div class="dev-modal hidden" id="dev-modal">
      <div class="dev-modal__inner">
        <div class="dev-modal__header">
          <h2>üõ†Ô∏è Dev Tools</h2>
          <button id="dev-modal-close" class="btn ghost small" aria-label="Close Dev Tools">Close</button>
        </div>
        <div class="dev-modal__body">
          <div class="dev-panel" id="dev-panel" data-panel="dev">
            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px;">
              <button id="toggle-dev" type="button">Toggle Road Eligible</button>
              <button id="toggle-labels" type="button">Toggle Tile Labels</button>
              <button id="run-golden" type="button">Run Golden Test</button>
              <button id="run-random" type="button">Run Random Campaign</button>
            </div>
            <div id="dev-controls" style="display:grid; gap:8px; margin-bottom:10px;">
              <label style="display:flex; align-items:center; gap:8px; font-size:13px; color:var(--muted);">
                <input type="checkbox" id="dev-highways-unlocked">
                Highways unlocked (playtest)
              </label>
              <label style="display:flex; flex-direction:column; gap:4px; font-size:13px; color:var(--muted);">
                Base growth multiplier
                <input type="range" id="dev-growth-multiplier" min="0.5" max="1.5" step="0.05" value="1" style="accent-color:#9fc3ff;">
                <span id="dev-growth-multiplier-value" style="font-size:12px; color:var(--faint);">1.00</span>
              </label>
              <label style="display:flex; flex-direction:column; gap:4px; font-size:13px; color:var(--muted);">
                Blight decay rate
                <input type="range" id="dev-blight-decay" min="0" max="0.1" step="0.01" value="0.05" style="accent-color:#9fc3ff;">
                <span id="dev-blight-decay-value" style="font-size:12px; color:var(--faint);">0.05</span>
              </label>
              <label style="display:flex; flex-direction:column; gap:4px; font-size:13px; color:var(--muted);">
                Max tile level
                <input type="range" id="dev-max-tile-level" min="2" max="8" step="1" value="6" style="accent-color:#9fc3ff;">
                <span id="dev-max-tile-level-value" style="font-size:12px; color:var(--faint);">6</span>
              </label>
              <label style="display:flex; flex-direction:column; gap:4px; font-size:13px; color:var(--muted);">
                Upgrade cost scaling
                <input type="range" id="dev-upgrade-scaling" min="0" max="2" step="0.25" value="0" style="accent-color:#9fc3ff;">
                <span id="dev-upgrade-scaling-value" style="font-size:12px; color:var(--faint);">0.00</span>
              </label>
              <label style="display:flex; flex-direction:column; gap:4px; font-size:13px; color:var(--muted);">
                Road adjacency bonus
                <input type="range" id="dev-road-bonus" min="0" max="0.3" step="0.05" value="0" style="accent-color:#9fc3ff;">
                <span id="dev-road-bonus-value" style="font-size:12px; color:var(--faint);">0.00</span>
              </label>
              <label style="display:flex; flex-direction:column; gap:4px; font-size:13px; color:var(--muted);">
                Census multiplier
                <input type="range" id="dev-census-multiplier" min="0.8" max="1.2" step="0.05" value="1" style="accent-color:#9fc3ff;">
                <span id="dev-census-multiplier-value" style="font-size:12px; color:var(--faint);">1.00</span>
              </label>
              <button id="dev-copy-settings" type="button">Copy Dev Settings JSON</button>
            </div>
            <div style="display:grid; gap:4px; margin-bottom:12px;">
              <div style="font-size:12px; letter-spacing:0.12em; text-transform:uppercase; color:var(--muted);">Dev Toggles (First 6)</div>
              <div style="font-size:13px; color:var(--text); line-height:1.4;">
                1. Base Growth Multiplier<br>
                2. Blight Decay Rate<br>
                3. Max Tile Level<br>
                4. Upgrade Cost Scaling<br>
                5. Road Adjacency Bonus<br>
                6. Census Multiplier
              </div>
            </div>
            <section id="devtools" style="display:none; margin:8px 0 12px;">
              <div style="font-size:12px; letter-spacing:0.12em; text-transform:uppercase; color:var(--muted); margin-bottom:6px;">Auto Run</div>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button type="button" id="dev-autorun-1">Auto Run (1 campaign)</button>
                <button type="button" id="dev-stop">Stop</button>
              </div>
              <div id="dev-out" style="margin-top:10px; color: var(--muted); font-size: 13px;"></div>
            </section>
            <div id="dev-info" style="margin-top: 12px; color: var(--muted); font-size: 13px;"></div>
            <pre id="golden-output" style="margin-top:10px;"></pre>
          </div>
        </div>
      </div>
    </div>

    <div class="final-modal hidden" id="final-summary-modal" aria-modal="true" role="dialog">
      <div class="final-modal__inner">
        <div class="final-modal__header">
          <div class="final-modal__title" id="final-summary-title">A City‚Äôs Legacy</div>
          <div class="final-modal__sub" id="final-summary-sub">Final census resolved</div>
          <button class="final-modal__close" id="final-summary-close" aria-label="Close summary">√ó</button>
        </div>
        <div class="final-modal__body">
          <p class="final-modal__snapshot" id="final-summary-snapshot">A campaign summary will appear here.</p>
          <div class="final-modal__census">
            <div class="final-modal__census-label">Final Population</div>
            <div class="final-modal__census-value" id="final-summary-census">0</div>
            <div class="final-modal__census-sub" id="final-summary-census-sub">Estimated census at campaign close</div>
            <div class="final-modal__census-rare" id="final-summary-census-rare" style="display:none;">Among the largest cities on record.</div>
          </div>
          <div class="final-modal__section">
            <div class="final-modal__section-title">Sector Breakdown</div>
            <div class="final-modal__sectors" id="final-summary-sectors"></div>
          </div>
          <div class="final-modal__section">
            <div class="final-modal__section-title">Key Decisions & Turning Points</div>
            <ul class="final-modal__turning" id="final-summary-turning"></ul>
          </div>
        </div>
        <div class="final-modal__footer">
          <div class="final-modal__badge" id="final-summary-badge">Balanced Capital</div>
          <div class="final-modal__actions">
            <button class="btn ghost" id="final-summary-view">View Campaign Stats</button>
            <button class="btn primary" id="final-summary-new">Start New City</button>
          </div>
        </div>
      </div>
    </div>

    <section class="frame" id="frame-players" data-panel="players">
      <h2>üë• Players & Roles</h2>
      <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
        <label style="margin:0; flex-direction: row; align-items: center; gap: 8px;">
          Player count
          <select id="player-count">
            <option value="3">3</option>
            <option value="4" selected>4</option>
            <option value="5">5</option>
          </select>
        </label>
        <div style="font-size:12px; color:var(--muted);">Roles are assigned by seat order.</div>
      </div>
      <div id="player-list" class="inputs-grid"></div>
      <div class="phase-cta">
        <button id="primary-cta" class="btn primary">Begin City</button>
      </div>
    </section>

    <div id="menu-drawer" class="menu-drawer hidden">
      <div class="menu-drawer__header">
        <span>Menu</span>
        <button id="menu-close" class="btn ghost small">Close</button>
      </div>
      <div class="menu-drawer__content">
        <button class="menu-link" data-peek="players">Players & Roles</button>
        <button class="menu-link" data-peek="round-input">Census Intake</button>
        <button class="menu-link" data-peek="missions">Initiatives</button>
        <button class="menu-link" data-peek="stats">Civic Metrics</button>
        <button class="menu-link" data-peek="status">City Status</button>
        <button class="menu-link" data-peek="report">Planning Memo</button>
        <button class="menu-link" data-peek="history">History</button>
        <button class="menu-link" data-peek="dev">Dev Tools</button>
        <details class="menu-link" style="border:none; background:transparent; padding:0; color:var(--text);">
          <summary style="cursor:pointer; padding:10px 12px; border:1px solid rgba(255,255,255,0.12); border-radius:12px; background:rgba(255,255,255,0.04);">Planning Principles</summary>
          <div style="padding:10px 12px; border:1px solid rgba(255,255,255,0.08); border-radius:12px; background:rgba(255,255,255,0.03); display:grid; gap:6px; margin-top:6px;">
            <div><strong>Residential</strong><div style="color:var(--muted); font-size:12px;">Wants access to jobs and services.</div></div>
            <div><strong>Commerce</strong><div style="color:var(--muted); font-size:12px;">Supports population only if housing exists.</div></div>
            <div><strong>Infrastructure</strong><div style="color:var(--muted); font-size:12px;">Improves efficiency, not population directly.</div></div>
            <div><strong>Civic</strong><div style="color:var(--muted); font-size:12px;">Enables stability and higher density later.</div></div>
          </div>
        </details>
        <button id="menu-return" class="btn small ghost">Return to Phase View</button>
      </div>
    </div>
  </main>

  <script type="module" src="./src/main.js"></script>
</body>
</html>
